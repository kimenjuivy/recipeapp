const nigerianRecipes = [
    {
        name: "Riz au Gras",
        image: "assets/mali/riz-au-gras.jpg",
        description: "A rich Malian dish made with rice, vegetables, and meat cooked in a flavorful sauce.",
        ingredients: [
            "500g Long grain rice",
            "3 cooking spoons Palm oil",
            "2 Large Onions",
            "6 or more Red chilli peppers",
            "3 large Fresh tomatoes",
            "3 tablespoons Tomato paste",
            "1 clove Garlic",
            "Bay leaves",
            "Thyme",
            "3 Maggi cubes",
            "500g Beef or Goat meat",
            "100g Dried fish",
            "40g Cooked black-eyed peas",
            "2 Smoked fish (optional)",
            "4 pieces of Smoked turkey or 50g Smoked shrimp",
            "A bunch of Plantains",
            "500ml Water"
        ],
        instructions: [
            "Heat palm oil in a deep pot, add sliced onions and cook until translucent.",
            "Add chopped tomatoes, tomato paste, chopped red chilli peppers, and minced garlic. Stir and cook for 5 minutes.",
            "Add water, bay leaves, thyme, Maggi cubes, and meat. Simmer for 30 minutes or until meat is tender.",
            "Add rice, black-eyed peas, and smoked fish. Stir gently to combine, cover, and cook over medium heat until rice is cooked through and liquid is absorbed, about 20 minutes.",
            "In another pan, fry smoked turkey or shrimp until golden brown.",
            "Serve the Riz au Gras hot, garnished with fried plantains and smoked turkey or shrimp."
        ]
    },
    {
        name: "Brochettes",
        image: "assets/mali/brochettes.jpg",
        description: "Skewered and grilled meat, typically served with spicy sauces.",
        ingredients: [
            "1kg Beef or Goat meat, cut into cubes",
            "2 Large Onions",
            "4 cloves Garlic",
            "1 teaspoon Ground ginger",
            "1 teaspoon Ground cumin",
            "1 teaspoon Ground coriander",
            "1 teaspoon Paprika",
            "1 teaspoon Cayenne pepper",
            "Salt and pepper to taste",
            "2 tablespoons Vegetable oil"
        ],
        instructions: [
            "In a bowl, combine chopped onions, minced garlic, ground ginger, cumin, coriander, paprika, cayenne pepper, salt, pepper, and vegetable oil.",
            "Add meat cubes to the marinade, coat well, cover, and refrigerate for at least 1 hour or overnight.",
            "Thread marinated meat onto skewers.",
            "Preheat grill to medium-high heat. Grill brochettes, turning occasionally, until meat is cooked to desired doneness, about 10-15 minutes.",
            "Serve hot with spicy sauces and rice or couscous."
        ]
    },
    {
        name: "Maafe",
        image: "assets/mali/maafe.jpg",
        description: "A hearty stew made with meat, peanuts, and vegetables.",
        ingredients: [
            "500g Beef or Chicken, cut into pieces",
            "2 Large Onions",
            "4 cloves Garlic",
            "1 cup Peanut butter",
            "3 large Fresh tomatoes, chopped",
            "3 tablespoons Tomato paste",
            "2 Large Carrots, sliced",
            "2 Large Potatoes, diced",
            "1 Eggplant, diced",
            "2 Maggi cubes",
            "1 teaspoon Ground cayenne pepper",
            "Salt and pepper to taste",
            "2 tablespoons Vegetable oil",
            "500ml Water"
        ],
        instructions: [
            "In a large pot, heat vegetable oil over medium heat. Add chopped onions and minced garlic, cook until softened.",
            "Add meat pieces and brown on all sides.",
            "Add chopped tomatoes, tomato paste, peanut butter, Maggi cubes, ground cayenne pepper, salt, and pepper. Stir well to combine.",
            "Add water and bring to a boil. Reduce heat, cover, and simmer for 1 hour or until meat is tender.",
            "Add sliced carrots, diced potatoes, and diced eggplant. Simmer for an additional 20-30 minutes or until vegetables are tender and stew has thickened.",
            "Serve hot over rice or couscous."
        ]
    },
    {
        name: "Tiep Bou Yap",
        image: "assets/mali/tiep-bou-yap.jpg",
        description: "A flavorful rice dish with fish, vegetables, and spices, popular in Mali.",
        ingredients: [
            "500g Long grain rice",
            "3 tablespoons Vegetable oil",
            "2 Large Onions",
            "4 cloves Garlic",
            "3 large Fresh tomatoes, chopped",
            "3 tablespoons Tomato paste",
            "2 Eggplants, diced",
            "2 Large Carrots, sliced",
            "500g Fish (such as tilapia or sea bass)",
            "2 Maggi cubes",
            "1 teaspoon Ground cayenne pepper",
            "Salt and pepper to taste",
            "500ml Water"
        ],
        instructions: [
            "In a large pot, heat vegetable oil over medium heat. Add chopped onions and minced garlic, cook until softened.",
            "Add chopped tomatoes, tomato paste, diced eggplant, sliced carrots, Maggi cubes, ground cayenne pepper, salt, and pepper. Stir well to combine.",
            "Add water and bring to a boil. Reduce heat, cover, and simmer for 10 minutes.",
            "Add fish pieces to the pot, cover, and simmer for an additional 20 minutes or until rice is cooked through and fish is flaky.",
            "Serve hot, garnished with fresh parsley or cilantro."
        ]
    },
    {
        name: "Foufou",
        image: "assets/mali/foufou.jpg",
        description: "A starchy side dish made from pounded yams, cassava, or plantains.",
        ingredients: [
            "500g Cassava or Yam",
            "Water",
            "Salt to taste"
        ],
        instructions: [
            "Peel cassava or yam and cut into chunks.",
            "Place in a large pot and cover with water. Bring to a boil and cook until tender, about 20-30 minutes.",
            "Drain and transfer cooked cassava or yam to a large bowl.",
            "Using a mortar and pestle or large spoon, pound until smooth and stretchy.",
            "Serve hot as a side dish with stews or sauces."
        ]
    },
    {
        name: "Babenda",
        image: "assets/mali/babenda.jpg",
        description: "A traditional Malian dish made from ground baobab leaves cooked with meat or fish.",
        ingredients: [
            "200g Dried baobab leaves",
            "500g Beef or Fish",
            "2 Large Onions",
            "4 cloves Garlic",
            "1 cup Ground peanuts",
            "3 tablespoons Vegetable oil",
            "2 Maggi cubes",
            "1 teaspoon Ground cayenne pepper",
            "Salt and pepper to taste",
            "500ml Water"
        ],
        instructions: [
            "In a large pot, heat vegetable oil over medium heat. Add chopped onions and minced garlic, cook until softened.",
            "Add meat or fish and brown on all sides.",
            "Add dried baobab leaves, ground peanuts, Maggi cubes, ground cayenne pepper, salt, and pepper. Stir well to combine.",
            "Add water and bring to a boil. Reduce heat, cover, and simmer for 1 hour or until meat or fish is tender.",
            "Serve hot over rice or couscous."
        ]
    }
];
function generateRecipeHTML(recipe) {
    const recipeElement = document.createElement('div');
    recipeElement.className = 'recipe-container';
    recipeElement.innerHTML = `
        <div class="recipe-image-container">
            <img src="${recipe.image}" alt="${recipe.name}">
        </div>
        <div class="recipe-content">
            <h3>${recipe.name}</h3>
            <p>${recipe.description}</p>
            <button class="view-recipe-btn">View Recipe</button>
            <div class="recipe-details" style="display: none;">
                <h4>Ingredients:</h4>
                <ul>${recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')}</ul>
                <h4>Instructions:</h4>
                <ol>${recipe.instructions.map(inst => `<li>${inst}</li>`).join('')}</ol>
                <button onclick="downloadRecipe('${recipe.name}')">Download Recipe as PDF</button>
            </div>
        </div>
    `;
    return recipeElement;
}

function downloadRecipe(recipeName) {
    const recipe = nigerianRecipes.find(r => r.name === recipeName);
    
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Set the title
    doc.setFontSize(24);
    doc.setTextColor(244, 164, 96); // A nice orange color
    doc.text(recipe.name, 105, 20, null, null, 'center');

    // Add the image
    try {
        const imgData = getBase64Image(recipe.image);
        doc.addImage(imgData, 'JPEG', 15, 30, 180, 100);
    } catch (error) {
        console.error('Error adding image to PDF:', error);
    }

    // Add ingredients
    doc.setFontSize(16);
    doc.setTextColor(0, 0, 0);
    doc.text('Ingredients:', 15, 140);

    doc.autoTable({
        startY: 145,
        head: [['Ingredients']],
        body: recipe.ingredients.map(ing => [ing]),
        theme: 'striped',
        headStyles: { fillColor: [244, 164, 96], textColor: 255 },
        margin: { left: 15, right: 15 },
    });

    // Add instructions
    let finalY = doc.lastAutoTable.finalY || 145;
    doc.setFontSize(16);
    doc.text('Instructions:', 15, finalY + 10);

    doc.autoTable({
        startY: finalY + 15,
        head: [['Step', 'Instruction']],
        body: recipe.instructions.map((inst, index) => [index + 1, inst]),
        theme: 'striped',
        headStyles: { fillColor: [244, 164, 96], textColor: 255 },
        margin: { left: 15, right: 15 },
    });

    doc.save(`${recipe.name}.pdf`);
}

function getBase64Image(imgUrl) {
    const img = new Image();
    img.crossOrigin = 'Anonymous';
    img.src = imgUrl;
    const canvas = document.createElement('canvas');
    canvas.width = img.width;
    canvas.height = img.height;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0);
    return canvas.toDataURL('image/jpeg');
}

document.addEventListener('DOMContentLoaded', () => {
    const recipesSection = document.getElementById('recipes');
    nigerianRecipes.forEach(recipe => {
        const recipeCard = generateRecipeHTML(recipe);
        recipesSection.appendChild(recipeCard);

        const viewRecipeBtn = recipeCard.querySelector('.view-recipe-btn');
        const recipeDetails = recipeCard.querySelector('.recipe-details');

        viewRecipeBtn.addEventListener('click', () => {
            if (recipeDetails.style.display === 'none') {
                recipeDetails.style.display = 'block';
                viewRecipeBtn.textContent = 'Hide Recipe';
            } else {
                recipeDetails.style.display = 'none';
                viewRecipeBtn.textContent = 'View Recipe';
            }
        });
    });
});